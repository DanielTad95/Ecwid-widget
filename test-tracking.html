<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Order Tracking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã Order Tracking</h1>
    
    <div class="test-section">
        <h3>üìä –¢–µ—Å—Ç localStorage tracking</h3>
        <button onclick="testAddProduct()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –≤ tracking</button>
        <button onclick="showTracking()">–ü–æ–∫–∞–∑–∞—Ç—å tracking –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="clearTracking()">–û—á–∏—Å—Ç–∏—Ç—å tracking</button>
        <div id="trackingResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>üåê –¢–µ—Å—Ç Analytics API</h3>
        <button onclick="testAnalyticsGet()">–ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É</button>
        <button onclick="testAnalyticsPost()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å add-to-cart</button>
        <div id="analyticsResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>üõí –°–∏–º—É–ª—è—Ü–∏—è widget tracking</h3>
        <button onclick="simulateWidgetAddToCart(456, 'Test Widget Product')">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        <div id="widgetResult" class="result"></div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (–∫–∞–∫ –≤ –≤–∏–¥–∂–µ—Ç–µ)
        let widgetAddedProducts = JSON.parse(localStorage.getItem('widgetAddedProducts') || '[]');
        
        function testAddProduct() {
            const trackingItem = {
                productId: Math.floor(Math.random() * 1000),
                action: 'add_to_cart',
                timestamp: new Date().toISOString(),
                widget: 'recently-updated-products'
            };
            
            widgetAddedProducts.push(trackingItem);
            localStorage.setItem('widgetAddedProducts', JSON.stringify(widgetAddedProducts));
            
            document.getElementById('trackingResult').textContent = `–î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–¥—É–∫—Ç: ${JSON.stringify(trackingItem, null, 2)}`;
        }
        
        function showTracking() {
            const tracking = JSON.parse(localStorage.getItem('widgetAddedProducts') || '[]');
            document.getElementById('trackingResult').textContent = `–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ tracking: ${tracking.length}\n\n${JSON.stringify(tracking, null, 2)}`;
        }
        
        function clearTracking() {
            localStorage.removeItem('widgetAddedProducts');
            widgetAddedProducts = [];
            document.getElementById('trackingResult').textContent = 'Tracking –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã';
        }
        
        async function testAnalyticsGet() {
            try {
                const response = await fetch('http://localhost:3001/api/analytics/widget-analytics');
                const data = await response.json();
                document.getElementById('analyticsResult').textContent = `–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                document.getElementById('analyticsResult').textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function testAnalyticsPost() {
            try {
                const response = await fetch('http://localhost:3001/api/analytics/widget-analytics/add-to-cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productId: 789,
                        productName: 'Test API Product',
                        productSku: 'API-TEST-SKU'
                    })
                });
                const data = await response.json();
                document.getElementById('analyticsResult').textContent = `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                document.getElementById('analyticsResult').textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function simulateWidgetAddToCart(productId, productName) {
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ –ø—Ä–æ—Ü–µ—Å—Å, –∫–∞–∫ –≤ –≤–∏–¥–∂–µ—Ç–µ
            const trackingItem = {
                productId: productId,
                action: 'add_to_cart',
                timestamp: new Date().toISOString(),
                widget: 'recently-updated-products'
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ localStorage
            widgetAddedProducts.push(trackingItem);
            localStorage.setItem('widgetAddedProducts', JSON.stringify(widgetAddedProducts));
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ analytics
            try {
                const response = await fetch('http://localhost:3001/api/analytics/widget-analytics/add-to-cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productId: productId,
                        productName: productName,
                        productSku: '',
                        timestamp: new Date().toISOString(),
                        widget: 'recently-updated-products'
                    })
                });
                const data = await response.json();
                document.getElementById('widgetResult').textContent = `–£—Å–ø–µ—à–Ω–æ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É:\nLocalStorage: ${JSON.stringify(trackingItem, null, 2)}\nAPI Response: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                document.getElementById('widgetResult').textContent = `–û—à–∏–±–∫–∞ API: ${error.message}`;
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            showTracking();
        };
    </script>
</body>
</html>
